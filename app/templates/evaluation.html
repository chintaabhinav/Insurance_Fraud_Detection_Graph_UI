{% extends "base.html" %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <div class="flex justify-between items-end mb-8">
        <div>
            <h1 class="text-3xl font-bold text-slate-900 dark:text-white mb-2">Model Evaluation</h1>
            <p class="text-slate-500 dark:text-slate-400">Assess the performance of the fraud detection pipeline.</p>
        </div>
        <button id="run-eval-btn"
            class="px-6 py-2.5 bg-blue-600 hover:bg-blue-500 text-white rounded-xl font-medium transition-all flex items-center gap-2">
            <i class="fa-solid fa-play"></i> Run New Evaluation
        </button>
    </div>

    <!-- Progress Bar (Hidden by default) -->
    <div id="eval-progress" class="hidden glass-card rounded-2xl p-6 mb-8">
        <div class="flex justify-between text-sm text-slate-700 dark:text-slate-300 mb-2">
            <span>Processing Validation Set A...</span>
            <span id="progress-text">0%</span>
        </div>
        <div class="w-full bg-slate-200 dark:bg-slate-800 rounded-full h-2.5 overflow-hidden">
            <div id="progress-bar" class="bg-blue-500 h-2.5 rounded-full transition-all duration-300" style="width: 0%">
            </div>
        </div>
    </div>

    <!-- Metrics Grid -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="glass-card rounded-2xl p-6 flex items-center justify-between">
            <div>
                <p class="text-slate-500 dark:text-slate-400 text-sm font-medium">Accuracy</p>
                <h1 class="text-3xl font-bold text-slate-900 dark:text-white mt-1">94.2%</h1>
            </div>
            <div
                class="w-12 h-12 rounded-full bg-emerald-500/10 flex items-center justify-center border border-emerald-500/20">
                <i class="fa-solid fa-bullseye text-emerald-500 dark:text-emerald-400"></i>
            </div>
        </div>
        <div class="glass-card rounded-2xl p-6 flex items-center justify-between">
            <div>
                <p class="text-slate-500 dark:text-slate-400 text-sm font-medium">Precision</p>
                <h1 class="text-3xl font-bold text-slate-900 dark:text-white mt-1">91.5%</h1>
            </div>
            <div
                class="w-12 h-12 rounded-full bg-blue-500/10 flex items-center justify-center border border-blue-500/20">
                <i class="fa-solid fa-crosshairs text-blue-500 dark:text-blue-400"></i>
            </div>
        </div>
        <div class="glass-card rounded-2xl p-6 flex items-center justify-between">
            <div>
                <p class="text-slate-500 dark:text-slate-400 text-sm font-medium">Recall</p>
                <h1 class="text-3xl font-bold text-slate-900 dark:text-white mt-1">88.9%</h1>
            </div>
            <div
                class="w-12 h-12 rounded-full bg-purple-500/10 flex items-center justify-center border border-purple-500/20">
                <i class="fa-solid fa-filter text-purple-500 dark:text-purple-400"></i>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Confusion Matrix -->
        <div class="glass-card rounded-2xl p-6">
            <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-6">Confusion Matrix</h3>
            <div class="grid grid-cols-2 gap-2 max-w-sm mx-auto">
                <!-- Header -->
                <div class="col-span-2 flex justify-between text-xs text-slate-500 px-2">
                    <span>Predicted Legit</span>
                    <span>Predicted Fraud</span>
                </div>

                <!-- Matrix -->
                <div
                    class="bg-slate-200/50 dark:bg-slate-800/50 p-8 rounded-xl border border-slate-300 dark:border-slate-700 text-center">
                    <h2 class="text-2xl font-bold text-slate-900 dark:text-white">45</h2>
                    <p class="text-xs text-slate-500 dark:text-slate-400">True Negative</p>
                </div>
                <div class="bg-red-500/10 p-8 rounded-xl border border-red-500/20 text-center">
                    <h2 class="text-2xl font-bold text-red-600 dark:text-red-400">5</h2>
                    <p class="text-xs text-red-600/70 dark:text-red-300/70">False Positive</p>
                </div>
                <div class="bg-orange-500/10 p-8 rounded-xl border border-orange-500/20 text-center">
                    <h2 class="text-2xl font-bold text-orange-600 dark:text-orange-400">8</h2>
                    <p class="text-xs text-orange-600/70 dark:text-orange-300/70">False Negative</p>
                </div>
                <div class="bg-blue-500/10 p-8 rounded-xl border border-blue-500/20 text-center">
                    <h2 class="text-2xl font-bold text-blue-600 dark:text-blue-400">42</h2>
                    <p class="text-xs text-blue-600/70 dark:text-blue-300/70">True Positive</p>
                </div>
            </div>
        </div>

        <!-- Misclassified Table -->
        <div class="glass-card rounded-2xl p-6">
            <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-6">Misclassified Samples</h3>
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm text-slate-500 dark:text-slate-400">
                    <thead
                        class="text-xs uppercase bg-slate-200/50 dark:bg-slate-800/50 text-slate-600 dark:text-slate-300">
                        <tr>
                            <th class="px-4 py-3 rounded-l-lg">ID</th>
                            <th class="px-4 py-3">Actual</th>
                            <th class="px-4 py-3">Pred</th>
                            <th class="px-4 py-3 rounded-r-lg">Conf</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-200 dark:divide-slate-700/50">
                        <tr>
                            <td class="px-4 py-3 font-mono">CLM-102</td>
                            <td class="px-4 py-3 text-red-600 dark:text-red-400">Fraud</td>
                            <td class="px-4 py-3 text-emerald-600 dark:text-emerald-400">Legit</td>
                            <td class="px-4 py-3">0.45</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-3 font-mono">CLM-156</td>
                            <td class="px-4 py-3 text-emerald-600 dark:text-emerald-400">Legit</td>
                            <td class="px-4 py-3 text-red-600 dark:text-red-400">Fraud</td>
                            <td class="px-4 py-3">0.62</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    const runBtn = document.getElementById('run-eval-btn');
    const progressContainer = document.getElementById('eval-progress');
    const progressBar = document.getElementById('progress-bar');
    const progressText = document.getElementById('progress-text');

    runBtn.addEventListener('click', () => {
        progressContainer.classList.remove('hidden');
        runBtn.disabled = true;
        runBtn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Running...';

        let width = 0;
        const interval = setInterval(() => {
            if (width >= 100) {
                clearInterval(interval);
                runBtn.disabled = false;
                runBtn.innerHTML = '<i class="fa-solid fa-play"></i> Run New Evaluation';
                setTimeout(() => {
                    progressContainer.classList.add('hidden');
                    progressBar.style.width = '0%';
                }, 1000);
            } else {
                width++;
                progressBar.style.width = width + '%';
                progressText.innerText = width + '%';
            }
        }, 30);
    });
</script>
{% endblock %}